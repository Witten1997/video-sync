# 配置说明

访问「配置中心」页面进行所有配置管理。配置分为多个选项卡，修改后点击「保存配置」生效。

## 基本设置

### 同步间隔（秒）
程序每次执行扫描下载的间隔时间，单位为秒，最小值60秒。修改后实时生效，无需重启。

### 下载基础路径
视频文件的保存根目录。建议使用绝对路径，如

Linux: `/downloads/bilibili`

Windows: `D:\Downloads` 

Linux下跟Windows下路径配置不同，请注意区分

### UP主信息路径
UP主头像和元数据的保存位置。对于 Emby/Jellyfin 用户，需指向媒体服务器的 `/metadata/people/` 目录才能正常显示头像。

### 视频名称模板
设置下载文件的命名规则，支持模板变量：
- `\{\{bvid\}\}` - 视频编号
- `\{\{title\}\}` - 视频标题
- `\{\{upper_name\}\}` - UP主名称
- `\{\{pubtime\}\}` - 视频发布时间

**示例**：
- `\{\{upper_name\}\}/\{\{title\}\}` - 按UP主分文件夹存储
- `\{\{title\}\}_\{\{pubtime\}\}` - 标题加时间戳

**高级用法**：
- `\{\{ truncate title 50 \}\}` - 截取标题前50个字符，避免文件名过长

### 分P名称模板
多分P视频的命名规则，除支持视频名称的全部变量外，还支持：
- `\{\{ptitle\}\}` - 分P标题
- `\{\{pid\}\}` - 分P页号

### 目录结构

视频名称模板荷分P名称模板用于设置下载文件的命名规则，对于所有下载的内容，使用的目录结构如下所示

1. 单页视频

   ```bash
   {download_base}/
   └── [视频标题]/
       ├── [视频标题].mp4           # 视频文件
       ├── [视频标题].nfo           # 元数据文件（可选）
       ├── [视频标题]-poster.jpg    # 封面图（可选）
       └── [视频标题].zh-CN.ass     # 弹幕字幕（可选）
   ```

2. 多P视频

   ```bash
   downloads/
   └── [任务源名称]/
       └── [视频标题]/
           ├── [视频标题]-[分P1名称].mp4           # 视频文件
           ├── [视频标题]-[分P1名称].nfo           # 元数据文件（可选）
           ├── [视频标题]-[分P1名称]-poster.jpg    # 封面图（可选）
           └── [视频标题]-[分P1名称].zh-CN.ass     # 弹幕字幕（可选）
           ├── [视频标题]-[分P2名称].mp4           # 视频文件
           ├── [视频标题]-[分P2名称].nfo           # 元数据文件（可选）
           ├── [视频标题]-[分P2名称]-poster.jpg    # 封面图（可选）
           └── [视频标题]-[分P2名称].zh-CN.ass     # 弹幕字幕（可选）
   ```

通过当前目录结构，已经试验过Emby可以在一个视频里完美显示多个分集信息

## B站认证

### 扫码登录（推荐）
1. 点击「生成二维码」
2. 使用 B站 APP 扫描
3. 手机上确认登录
4. 凭据自动保存

二维码有效期180秒，失效后可重新生成。

### 手动输入
需填写以下字段：
- **SESSDATA** - 登录凭证
- **bili_jct** - 跨站请求令牌
- **buvid3** - 浏览器设备标识
- **DedeUserID** - 用户ID
- **ac_time_value** - 认证时间值

保存后会自动验证，显示用户信息（用户名、UID、等级、会员状态）。

## 视频设置

### 视频质量

#### 最高分辨率
选择下载的最高画质：
- **8K** - 8K超高清（需大会员）
- **杜比视界** - 杜比视界HDR（需大会员）
- **HDR真彩** - HDR高动态范围（需大会员）
- **4K超清** - 4K画质（需大会员）
- **1080P60** - 1080P 60帧（需大会员）
- **1080P+** - 1080P高码率（需大会员）
- **1080P** - 全高清
- **720P** - 高清
- **480P** - 标清
- **360P** - 流畅

#### 视频编码格式
按优先级顺序选择编码格式（可拖拽调整）：

- **AVC (H.264)** - 兼容性最好，硬件解码支持最广，但文件体积较大
- **HEVC (H.265)** - 压缩率更高，体积更小，需设备支持硬件解码
- **AV1** - 新一代编码，压缩率最高，设备支持较少

**建议**：
- 追求兼容性 → 优先选 AVC
- 设备支持新编码 → 优先选 HEVC 或 AV1（节省空间）

#### 音频质量
- **Hi-RES无损** - 高解析度无损音质
- **杜比全景声** - 杜比全景声音效
- **192K** - 高品质音质
- **132K** - 标准音质
- **64K** - 流畅音质

#### 启用CDN排序
优化下载来源选择，优先使用高质量CDN节点：
- 服务商 CDN（最优）
- 自建 CDN
- MCDN
- PCDN（最低）

可能提高下载速度，效果因地区网络环境而异。

### 下载选项

- **跳过封面下载** - 不下载视频封面图
- **跳过NFO元数据** - 不生成NFO文件（媒体库将无法识别）
- **跳过UP主信息** - 不下载UP主头像和信息
- **跳过弹幕** - 不下载弹幕
- **跳过字幕** - 不下载视频字幕

## 弹幕设置

自动将B站弹幕转换为ASS字幕格式。

### 弹幕持续时间（秒）
弹幕在屏幕上的停留时间，范围1-30秒，默认12秒。

### 字体设置
- **字体名称** - 默认 `Microsoft YaHei`
- **字体大小** - 范围10-100，默认38
- **粗体显示** - 启用后弹幕加粗

### 布局设置

#### 宽度比例
弹幕显示宽度相对视频宽度的比例，调大可避免重叠，范围0.5-3。

#### 水平间距（像素）
两条弹幕之间的最小水平距离。

#### 轨道大小（像素）
每条弹幕轨道的高度（行高），范围20-100。

#### 滚动弹幕高度百分比（%）
滚动弹幕可使用的屏幕高度百分比，0-100。

#### 底部弹幕高度百分比（%）
底部弹幕可使用的屏幕高度百分比，0-100。

### 显示效果

#### 透明度（0-255）
弹幕透明度，0为完全透明，255为完全不透明，默认180。

#### 描边宽度
弹幕文字的描边宽度，范围0-5，默认1.5。

#### 时间偏移（秒）
调整弹幕出现的时间，正值延后，负值提前，范围-60至60。

### 颜色设置

#### 强制使用自定义颜色
启用后所有弹幕使用统一颜色，忽略原始颜色。

#### 自定义弹幕颜色
选择弹幕颜色（需启用强制自定义颜色）。

## 高级设置

### 并发控制

#### 视频并发数
同时下载的视频任务数，范围1-10，默认3。

#### 分P并发数
每个视频内同时下载的分P数，范围1-10，默认2。

**实际并发度** ≈ 视频并发数 × 分P并发数

**建议**：不宜设置过大，避免网络拥堵和触发风控。

### 请求频率限制

#### 频率限制时间窗口（毫秒）
API请求的时间窗口，范围100-5000ms，默认250ms。

#### 频率限制请求数
在时间窗口内允许的最大请求数，范围1-20，默认4。

**含义**：每250毫秒最多发送4个请求。

**建议**：如频繁遇到风控，可调小该值（如减少请求数或增大时间窗口）。

### NFO时间类型
NFO文件中使用的时间类型：
- **收藏时间** - 视频加入收藏夹的时间
- **发布时间** - 视频发布时间

仅收藏夹视频有区别，其他类型两者相同。

## 工具管理

### yt-dlp 版本管理

查看和更新下载核心 yt-dlp 的版本。

#### 显示信息
- **运行平台** - 操作系统类型
- **当前版本** - 已安装的版本号
- **最新版本** - GitHub最新发布版本
- **更新方式** - 更新方法（如pip、二进制替换）

#### 操作
- **检查更新** - 查询最新版本
- **立即更新** - 更新到最新版本（需1-2分钟）

更新后会自动验证版本。
