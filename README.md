# bili-download

ä¸“ä¸º NAS ç”¨æˆ·è®¾è®¡çš„å“”å“©å“”å“©è§†é¢‘åŒæ­¥å·¥å…·ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–ä¸‹è½½ã€ç®¡ç†å’Œç»„ç»‡ Bç«™ è§†é¢‘ï¼Œä¸åª’ä½“æœåŠ¡å™¨ï¼ˆEmby/Jellyfinï¼‰æ— ç¼é›†æˆã€‚

## ç‰¹æ€§

- ğŸ¯ **å¤šç§è§†é¢‘æºæ”¯æŒ**ï¼šæ”¶è—å¤¹ã€ç¨åå†çœ‹ã€è§†é¢‘åˆé›†ã€UPä¸»æŠ•ç¨¿
- ğŸ“¦ **è‡ªåŠ¨åŒ–åŒæ­¥**ï¼šå®šæ—¶æ‰«æå’Œä¸‹è½½ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
- ğŸ¬ **åª’ä½“åº“å‹å¥½**ï¼šè‡ªåŠ¨ç”Ÿæˆ NFO å…ƒæ•°æ®ï¼Œæ”¯æŒ Emby/Jellyfin/Kodi
- ğŸš€ **é«˜æ•ˆä¸‹è½½**ï¼šåŸºäº yt-dlpï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ å’Œå¹¶å‘ä¸‹è½½
- ğŸ’¬ **å¼¹å¹•æ”¯æŒ**ï¼šè‡ªåŠ¨ä¸‹è½½å¹¶è½¬æ¢ä¸º ASS æ ¼å¼
- ğŸ¨ **Web ç®¡ç†ç•Œé¢**ï¼šå¯è§†åŒ–ç®¡ç†è§†é¢‘æºå’Œä¸‹è½½ä»»åŠ¡
- ğŸ³ **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šæ”¯æŒ Docker å’Œ Docker Compose
- ğŸ“Š **PostgreSQL æ•°æ®åº“**ï¼šé«˜æ€§èƒ½æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢

## é¡¹ç›®é¢„è§ˆ
- ä»ªè¡¨ç›˜
![img.png](img/img.png)
- å¿«æ·è®¢é˜…
![img_1.png](img/img_1.png)
![img_2.png](img/img_2.png)
- ä»»åŠ¡æºç®¡ç†
![img_3.png](img/img_3.png)
- è§†é¢‘åˆ—è¡¨
![img_4.png](img/img_4.png)
- ä»»åŠ¡ç®¡ç†
![img_5.png](img/img_5.png)
- é…ç½®
![img_8.png](img/img_8.png)
![img_9.png](img/img_9.png)
![img_10.png](img/img_10.png)
![img_11.png](img/img_11.png)
![img_12.png](img/img_12.png)
## æŠ€æœ¯æ ˆ

- **åç«¯**: Go 1.23.3
- **æ•°æ®åº“**: PostgreSQL
- **å‰ç«¯**: Vue 3 + Vite
- **ä¸‹è½½å¼•æ“**: yt-dlp

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Go 1.23.3+
- PostgreSQL 12+
- yt-dlp

### ä»æºç æ„å»º

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-org/bili-download.git
cd bili-download

# å®‰è£…ä¾èµ–
make install-deps

# ç¼–è¯‘é¡¹ç›®
make build

# è¿è¡Œ
./build/bili-download
```

### ä½¿ç”¨ Docker

```bash
# æ„å»ºé•œåƒ
make docker-build

# è¿è¡Œå®¹å™¨
make docker-run
```

### ä½¿ç”¨ Docker Compose

```bash
# å¯åŠ¨æœåŠ¡ï¼ˆåŒ…å« PostgreSQLï¼‰
docker-compose up -d
```

## é…ç½®

é¦–æ¬¡è¿è¡Œæ—¶ä¼šåœ¨ `configs/` ç›®å½•ä¸‹è‡ªåŠ¨ç”Ÿæˆé»˜è®¤é…ç½®æ–‡ä»¶ `config.yaml`ã€‚

å…³é”®é…ç½®é¡¹ï¼š

```yaml
# æ•°æ®åº“é…ç½®
database:
  host: "localhost"
  port: 5432
  user: "bili_sync"
  password: "your_password"
  dbname: "bili_sync"

# Bç«™è®¤è¯
bilibili:
  credential:
    sessdata: ""
    bili_jct: ""
    buvid3: ""

# ä¸‹è½½è·¯å¾„
paths:
  download_base: "/downloads/bilibili"
  upper_path: "/metadata/people"
```

è¯¦ç»†é…ç½®è¯´æ˜è¯·å‚è€ƒ [é…ç½®æ–‡æ¡£](./docs/config.md)ã€‚

## ç¯å¢ƒå˜é‡

æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–æ•°æ®åº“é…ç½®ï¼š

- `DB_HOST`: PostgreSQL ä¸»æœºåœ°å€
- `DB_PORT`: PostgreSQL ç«¯å£ï¼ˆé»˜è®¤ 5432ï¼‰
- `DB_USER`: æ•°æ®åº“ç”¨æˆ·å
- `DB_PASSWORD`: æ•°æ®åº“å¯†ç 
- `DB_NAME`: æ•°æ®åº“åç§°
- `DB_SSLMODE`: SSL æ¨¡å¼ï¼ˆé»˜è®¤ disableï¼‰

## å¼€å‘

### é¡¹ç›®ç»“æ„

```
bili-download/
â”œâ”€â”€ cmd/                    # ç¨‹åºå…¥å£
â”‚   â””â”€â”€ server/
â”œâ”€â”€ internal/               # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ adapter/           # è§†é¢‘æºé€‚é…å™¨
â”‚   â”œâ”€â”€ api/               # HTTP API
â”‚   â”œâ”€â”€ bilibili/          # Bç«™ API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ config/            # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ database/          # æ•°æ®åº“
â”‚   â”œâ”€â”€ downloader/        # ä¸‹è½½å™¨
â”‚   â””â”€â”€ ...
â”œâ”€â”€ web/                   # å‰ç«¯ä»£ç 
â”œâ”€â”€ configs/               # é…ç½®æ–‡ä»¶
â””â”€â”€ scripts/               # è„šæœ¬
```

### å¼€å‘å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼è¿è¡Œï¼ˆçƒ­é‡è½½ï¼‰
make dev

# è¿è¡Œæµ‹è¯•
make test

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
make test-coverage

# ä»£ç æ ¼å¼åŒ–
make fmt

# ä»£ç æ£€æŸ¥
make lint

# å¤šå¹³å°æ„å»º
make build-all
```

## ä½¿ç”¨æŒ‡å—

### æ·»åŠ è§†é¢‘æº

1. è®¿é—® Web ç•Œé¢ï¼šhttp://localhost:3000
2. è¿›å…¥"è§†é¢‘æºç®¡ç†"é¡µé¢
3. ç‚¹å‡»"æ·»åŠ è§†é¢‘æº"
4. è¾“å…¥æ”¶è—å¤¹ IDã€UPä¸» ID æˆ–åˆé›† URL
5. é…ç½®ä¸‹è½½é€‰é¡¹å’Œè¿‡æ»¤è§„åˆ™

### é…ç½® Bç«™ å‡­æ®

1. åœ¨æµè§ˆå™¨ä¸­ç™»å½• Bç«™
2. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹ Cookie
3. å¤åˆ¶ä»¥ä¸‹å­—æ®µåˆ°é…ç½®æ–‡ä»¶ï¼š
   - SESSDATA
   - bili_jct
   - buvid3
   - DedeUserID
   - ac_time_value

### åª’ä½“æœåŠ¡å™¨é›†æˆ

ä¸‹è½½çš„è§†é¢‘ä¼šæŒ‰ç…§ä»¥ä¸‹ç»“æ„ç»„ç»‡ï¼š

```
downloads/
â””â”€â”€ æ”¶è—å¤¹åç§°/
    â””â”€â”€ è§†é¢‘æ ‡é¢˜/
        â”œâ”€â”€ è§†é¢‘æ ‡é¢˜.mp4
        â”œâ”€â”€ è§†é¢‘æ ‡é¢˜.nfo
        â”œâ”€â”€ è§†é¢‘æ ‡é¢˜-poster.jpg
        â””â”€â”€ è§†é¢‘æ ‡é¢˜.zh-CN.default.ass
```

åœ¨ Emby/Jellyfin ä¸­æ·»åŠ åª’ä½“åº“æ—¶ï¼Œå°† `downloads/` ç›®å½•æ·»åŠ ä¸ºç”µå½±æˆ–ç”µè§†å‰§åº“å³å¯ã€‚

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•è·å–æ”¶è—å¤¹ IDï¼Ÿ

A: æ‰“å¼€æ”¶è—å¤¹é¡µé¢ï¼ŒURL ä¸­çš„æ•°å­—å³ä¸ºæ”¶è—å¤¹ IDã€‚ä¾‹å¦‚ï¼š`https://space.bilibili.com/xxx/favlist?fid=123456789`ï¼Œå…¶ä¸­ `123456789` å°±æ˜¯æ”¶è—å¤¹ IDã€‚

### Q: ä¸‹è½½å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ç¡®è®¤ yt-dlp å·²æ­£ç¡®å®‰è£…
2. æ£€æŸ¥ Bç«™ å‡­æ®æ˜¯å¦æœ‰æ•ˆ
3. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ä¸­çš„é”™è¯¯ä¿¡æ¯
4. å¯èƒ½è§¦å‘äº† Bç«™ é£æ§ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è‡´è°¢

- åŸé¡¹ç›®ï¼š[bili-sync](https://github.com/amtoaer/bili-sync)
- ä¸‹è½½å·¥å…·ï¼š[yt-dlp](https://github.com/yt-dlp/yt-dlp)
- Bç«™ API æ–‡æ¡£ï¼š[bilibili-API-collect](https://github.com/SocialSisterYi/bilibili-API-collect)

## å…è´£å£°æ˜

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºå•†ä¸šç”¨é€”ã€‚ä¸‹è½½çš„è§†é¢‘å†…å®¹ç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ï¼Œè¯·å°Šé‡åŸä½œè€…çš„åŠ³åŠ¨æˆæœã€‚
